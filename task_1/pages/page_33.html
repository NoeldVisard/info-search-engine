<!DOCTYPE html>

<html data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D" lang="ru">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1.0,viewport-fit=cover,maximum-scale=1,user-scalable=0" name="viewport"/>
<meta content="unsafe-url" name="referrer"/>
<title>SafeRAT: так ли он безопасен? / Хабр</title>







<meta content="2.165.0" name="habr-version"/>
<meta content="444736788986613" data-vue-meta="ssr" property="fb:app_id"/><meta content="472597926099084" data-vue-meta="ssr" property="fb:pages"/><meta content="summary_large_image" data-vue-meta="ssr" name="twitter:card"/><meta content="@habr_com" data-vue-meta="ssr" name="twitter:site"/><meta content="Хабр" data-vmid="og:site_name" data-vue-meta="ssr" property="og:site_name"/><meta content="SafeRAT: так ли он безопасен?" data-vmid="og:title" data-vue-meta="ssr" property="og:title"/><meta content="SafeRAT: так ли он безопасен?" data-vmid="twitter:title" data-vue-meta="ssr" name="twitter:title"/><meta content="SafeRAT: так ли он безопасен?" data-vmid="aiturec:title" data-vue-meta="ssr" name="aiturec:title"/><meta content="Большой хабросалют всем! С вами на связи я, Ксения Наумова, и мой коллега Антон Белоусов. Мы работаем в компании Positive Technologies, в отделе обнаружения вредоносного ПО. Я занимаюсь анализом и..." data-vmid="description" data-vue-meta="ssr" name="description"/><meta content="Большой хабросалют всем! С вами на связи я, Ксения Наумова, и мой коллега Антон Белоусов. Мы работаем в компании Positive Technologies, в отделе обнаружения вредоносного ПО. Я занимаюсь анализом и..." data-vmid="description:itemprop" data-vue-meta="ssr" itemprop="description"/><meta content="Большой хабросалют всем! С вами на связи я, Ксения Наумова, и мой коллега Антон Белоусов. Мы работаем в компании Positive Technologies, в отделе обнаружения вредоносного ПО. Я занимаюсь анализом и..." data-vmid="og:description" data-vue-meta="ssr" property="og:description"/><meta content="Большой хабросалют всем! С вами на связи я, Ксения Наумова, и мой коллега Антон Белоусов. Мы работаем в компании Positive Technologies, в отделе обнаружения вредоносного ПО. Я занимаюсь анализом и..." data-vmid="twitter:description" data-vue-meta="ssr" name="twitter:description"/><meta content="Большой хабросалют всем! С вами на связи я, Ксения Наумова, и мой коллега Антон Белоусов. Мы работаем в компании Positive Technologies, в отделе обнаружения вредоносного ПО. Я занимаюсь анализом и..." data-vmid="aiturec:description" data-vue-meta="ssr" property="aiturec:description"/><meta content="https://habrastorage.org/getpro/habr/upload_files/284/a3d/92a/284a3d92ae3b02b0e7f51b6424278c9b.png" data-vmid="image:itemprop" data-vue-meta="ssr" itemprop="image"/><meta content="https://habrastorage.org/getpro/habr/upload_files/284/a3d/92a/284a3d92ae3b02b0e7f51b6424278c9b.png" data-vmid="og:image" data-vue-meta="ssr" property="og:image"/><meta content="1200" data-vmid="og:image:width" data-vue-meta="ssr" property="og:image:width"/><meta content="630" data-vmid="og:image:height" data-vue-meta="ssr" property="og:image:height"/><meta content="https://habrastorage.org/getpro/habr/upload_files/284/a3d/92a/284a3d92ae3b02b0e7f51b6424278c9b.png" data-vmid="aiturec:image" data-vue-meta="ssr" property="aiturec:image"/><meta content="https://habrastorage.org/getpro/habr/upload_files/284/a3d/92a/284a3d92ae3b02b0e7f51b6424278c9b.png" data-vmid="twitter:image" data-vue-meta="ssr" name="twitter:image"/><meta content="https://habrastorage.org/getpro/habr/upload_files/284/a3d/92a/284a3d92ae3b02b0e7f51b6424278c9b.png?format=vk" data-vmid="vk:image" data-vue-meta="ssr" property="vk:image"/><meta content="793440" data-vmid="aiturec:item_id" data-vue-meta="ssr" property="aiturec:item_id"/><meta content="2024-02-16T09:33:22.000Z" data-vmid="aiturec:datetime" data-vue-meta="ssr" property="aiturec:datetime"/><meta content="https://habr.com/ru/companies/pt/articles/793440/" data-vmid="og:url" data-vue-meta="ssr" property="og:url"/><meta content="article" data-vmid="og:type" data-vue-meta="ssr" property="og:type"/><meta content="ru_RU" data-vmid="og:locale" data-vue-meta="ssr" property="og:locale"/><meta content="rat, cybersecurity, sandbox, стилер, кража данных, malware, шифрование данных, сетевой трафик, впо, загрузчик" data-vue-meta="ssr" name="keywords"/>

<meta content="#303b44" name="apple-mobile-web-app-status-bar-style"/>
<meta content="#629FBC" name="msapplication-TileColor"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="yes" name="mobile-web-app-capable"/>
































</head>
<body>
<div data-async-called="true" data-server-rendered="true" id="app"><div class="tm-layout__wrapper"><!-- --> <div></div> <div class="tm-feature tm-feature"><!-- --></div> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><div class="tm-header__burger-nav"><button class="tm-header__button tm-header__button_burger" type="button"><svg class="tm-svg-img tm-header__icon tm-header__icon-burger" height="16" width="16"><title>Меню</title> <use xlink:href="/img/megazord-v28.faec9762..svg#header-burger"></use></svg></button></div> <span class="tm-header__logo-wrap"><a class="tm-header__logo tm-header__logo tm-header__logo_hl-ru" href="/ru/"><svg class="tm-svg-img tm-header__icon" height="16" width="16"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <!-- --> <div class="tm-header-user-menu tm-header_user-menu"><a class="tm-header-user-menu__item tm-header-user-menu__search" href="/ru/search/"><svg class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search" height="24" width="24"><title>Поиск</title> <use xlink:href="/img/megazord-v28.faec9762..svg#search"></use></svg></a> <!-- --> <!-- --> <!-- --> <div class="tm-header-user-menu__item"><button class="tm-header-user-menu__toggle"><svg class="tm-svg-img tm-header-user-menu__icon" height="24" width="24"><title>Настройки</title> <use xlink:href="/img/megazord-v28.faec9762..svg#page-settings"></use></svg></button></div> <a class="tm-header-user-menu__item" href="https://habr.com/kek/v1/auth/habrahabr/?back=/ru/companies/pt/articles/793440/&amp;hl=ru" rel="nofollow"><button class="tm-header-user-menu__login btn btn_solid btn_small" type="button">
        Войти
      </button></a> <!-- --> <div class="v-portal" style="display:none;"></div></div></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <!-- --> <!-- --> <div class="tm-page-width"></div> <main class="tm-layout__container"><div class="tm-page" companyname="pt" data-async-called="true" hl="ru"><div class="tm-page-width"><!-- --> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><!-- --> <div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg class="tm-svg-img pull-down__icon pull-down__arrow" height="24" width="24"><title>Обновить</title> <use xlink:href="/img/megazord-v28.faec9762..svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"><!-- --> <!-- --> <!-- --> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet tm-article-snippet"> <div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a class="tm-user-info__userpic" href="/ru/users/naumovax/" title="naumovax"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="32" src="//habrastorage.org/r/w64/getpro/habr/avatars/772/0cc/637/7720cc6370da32f886345dcf87caf92f.jpg" width="32"/></div></a> <span class="tm-user-info__user tm-user-info__user_appearance-default"><a class="tm-user-info__username" href="/ru/users/naumovax/">
      naumovax
      <!-- --></a> <span class="tm-article-datetime-published"><time datetime="2024-02-16T09:33:22.000Z" title="2024-02-16, 12:33">вчера в 12:33</time></span></span></span></div> <!-- --></div> <h1 class="tm-title tm-title_h1" lang="ru"><span>SafeRAT: так ли он безопасен?</span></h1> <div class="tm-article-snippet__stats"><div class="tm-article-complexity tm-article-complexity_complexity-medium"><span class="tm-svg-icon__wrapper tm-article-complexity__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Уровень сложности</title> <use xlink:href="/img/megazord-v28.faec9762..svg#complexity-medium"></use></svg></span> <span class="tm-article-complexity__label">
    Средний
  </span></div> <div class="tm-article-reading-time"><span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Время на прочтение</title> <use xlink:href="/img/megazord-v28.faec9762..svg#clock"></use></svg></span> <span class="tm-article-reading-time__label">
    8 мин
  </span></div> <span class="tm-icon-counter tm-data-icons__item"><svg class="tm-svg-img tm-icon-counter__icon" height="24" width="24"><title>Количество просмотров</title> <use xlink:href="/img/megazord-v28.faec9762..svg#counter-views"></use></svg> <span class="tm-icon-counter__value">1.6K</span></span></div> <div class="tm-publication-hubs__container"><div class="tm-publication-hubs"><span class="tm-publication-hub__link-container"><a class="router-link-active tm-publication-hub__link" href="/ru/companies/pt/articles/"><span>Блог компании Positive Technologies</span> <!-- --></a></span><span class="tm-publication-hub__link-container"><a class="tm-publication-hub__link" href="/ru/hubs/infosecurity/"><span>Информационная безопасность</span> <span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span></a></span><span class="tm-publication-hub__link-container"><a class="tm-publication-hub__link" href="/ru/hubs/virus/"><span>Антивирусная защита</span> <span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span></a></span><span class="tm-publication-hub__link-container"><a class="tm-publication-hub__link" href="/ru/hubs/network_technologies/"><span>Сетевые технологии</span> <span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span></a></span><span class="tm-publication-hub__link-container"><a class="tm-publication-hub__link" href="/ru/hubs/reverse-engineering/"><span>Реверс-инжиниринг</span> <span class="tm-article-snippet__profiled-hub" title="Профильный хаб">*</span></a></span></div></div> <div class="tm-article-labels"><div class="tm-article-labels__container"><div class="tm-publication-label tm-publication-label_variant-case"><span>
    Кейс
  </span></div> </div></div> <!-- --> <!-- --></div></div> <!-- --> <div class="tm-article-body" data-gallery-root="" lang="ru"><div></div> <div id="post-content-body"><div><div class="article-formatted-body article-formatted-body article-formatted-body_version-2"><div xmlns="http://www.w3.org/1999/xhtml"><figure class="full-width"><img data-src="https://habrastorage.org/getpro/habr/upload_files/442/740/218/442740218d177f1b33ff74ecf640b352.png" height="440" src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/442/740/218/442740218d177f1b33ff74ecf640b352.png" width="780"/></figure><p>Большой хабросалют всем! С вами на связи я, Ксения Наумова, и мой коллега Антон Белоусов. Мы работаем в компании Positive Technologies, в отделе обнаружения вредоносного ПО. Я занимаюсь анализом и детектированием вредоносного ПО в сети, другими словами исследую вредоносный сетевой трафик, а также совершенствую инструменты для его анализа и ищу новые подходы к обнаружению сетевых угроз. А Антон — вирусный аналитик, он занимается исследованием вредоносов, разбирает на части образцы вирусов, чтобы придумать, как лучше их детектировать или как найти похожие друг на друга.</p><p>В декабре 2023 года, в ходе постоянного отслеживания новых угроз ИБ, <a href="https://www.ptsecurity.com/ru-ru/products/sandbox/">изучая в PT Sandbox</a> и других песочницах вредоносные образцы и генерируемый ими трафик, мы обнаружили подозрительное сетевое взаимодействие, с которого наше дальнейшее исследование и началось. Надо сказать, обратили мы внимание на это еще и благодаря внезапно увеличившемуся количеству похожих семплов. Сами злоумышленники, видимо призрачно надеясь на убедительность, назвали в коде свой троян удаленного действия SafeRAT, с именованием которого мы, конечно, не согласны, но довольно спойлеров! Ниже мы постарались детально описать вредонос, который ранее исследователям не встречался, чтобы показать его НЕбезопасность. </p><h2>Загрузчик</h2><p>Каждый загрузчик представляет собой довольно простой бинарный файл формата PE (EXE) с единственной функцией. Загрузчик распространяется по почте в письмах с расширением <code>.bat</code>. Оказавшись на компьютере жертвы, загрузчик с помощью функций библиотеки WinHTTP обращается к зашитому внутри него удаленному серверу (C2) за получением дополнительной полезной нагрузки следующего этапа.</p><figure class="full-width"><img data-src="https://habrastorage.org/getpro/habr/upload_files/a88/03c/094/a8803c094aac156d2b2080630c6841f4.png" height="164" src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/a88/03c/094/a8803c094aac156d2b2080630c6841f4.png" width="678"/></figure><p>Предполагаем, что код загрузки взят из <a href="https://learn.microsoft.com/en-us/windows/win32/winhttp/winhttp-sessions-overview">примера MSDN</a>, поскольку в некоторых семплах используется User-Agent:<code>WinHTTP Example/1.0</code>.  </p><figure class="full-width"><img data-src="https://habrastorage.org/getpro/habr/upload_files/d4a/1ea/8c9/d4a1ea8c9ab245c3dee76a4927f8eae1.png" height="257" src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/d4a/1ea/8c9/d4a1ea8c9ab245c3dee76a4927f8eae1.png" width="754"/></figure><p>Загрузчики незначительно различаются между собой, однако их функции идентичны. Ознакомиться подробнее с хешами можно в блоке <a href="#1">«Индикаторы компрометации. Загрузчики»</a>. </p><h2>Шеллкод</h2><p>64-битный шеллкод отдается C2 в ответ на GET-запрос <code>/payload.bin</code> в открытом виде.   </p><figure class="full-width"><img data-src="https://habrastorage.org/getpro/habr/upload_files/7f2/a4e/4e9/7f2a4e4e9dc95a65d1cb334bbd3868ce.png" height="574" src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/7f2/a4e/4e9/7f2a4e4e9dc95a65d1cb334bbd3868ce.png" width="800"/></figure><p>Значение User-Agent не всегда такое, как на скриншоте выше. Например, мы встречали такие User‑Agent, как <code>Chromium</code>, <code>Google</code>, <code>souhu</code>, <code>sougou</code>, <code>File Downloader</code>, <code>baidu</code>, <code>cpp-httplib/0.14.3</code>, <code>ShellcodeDownloader</code>, <code>python-requests/2.25.1</code>, <code>Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)</code>. </p><p>Далее исполнение стартует с 0-го байта.</p><figure class="full-width"><img data-src="https://habrastorage.org/getpro/habr/upload_files/a96/bd4/3b1/a96bd43b11f1b40410376af7ad425a13.png" height="394" src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/a96/bd4/3b1/a96bd43b11f1b40410376af7ad425a13.png" width="892"/></figure><p>Шеллкод получает свой адрес с помощью простого выражения.</p><figure class=""><img data-blurred="true" data-src="https://habrastorage.org/getpro/habr/upload_files/ccc/9a7/782/ccc9a77822c996abf9408e1ebb1f81b6.jpg" height="179" src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/ccc/9a7/782/ccc9a77822c996abf9408e1ebb1f81b6.jpg" width="337"/></figure><p>В конце шеллкода указаны адрес C2 и порт, как выделено на скриншоте выше. Они хранятся в следующем виде: </p><pre><code class="cpp">struct C2 { 
  uint32_t port;       
  char addr[256]; 
}; </code></pre><p>После этого шеллкод получает адреса API-функций с помощью кастомного алгоритма хеширования их имен:</p><pre><code class="cpp">def hash_exp(name, poly): 
    result = poly
    for i in range(len(name)): 
        result = (result * 0x21) &amp; 0xFFFFFFFFFFFFFFFF      
        v = struct.unpack_from('&lt;b', name, i)[0]
        i += 1
        result += v
    return result </code></pre><p>В процессе исследования мы столкнулись с двумя последовательными шеллкодами, имеющими как похожие функции, так и различия. </p><h3>Шеллкод № 1 (payload.bin) </h3><p>В этом шеллкоде параметр poly равен <code>0x85967AEFDADF5658</code>. Он находит следующие функции из ntdll: </p><ul><li><p><code>LdrLoadDll (0xD33201CB07BB2036) </code></p></li><li><p><code>RtlInitUnicodeString (0x4E80BBE9CCE6585C) </code></p></li><li><p><code>NtAllocateVirtualMemory (0xD1A4739FEC736F3F)</code> </p></li></ul><p>Шеллкод загружает библиотеку <code>ws2_32.dll</code>, а также получает адрес ее функции для создания сокета (TCP) и запроса шеллкода следующего этапа. Для этого отправляет следующий пакет на тот адрес C2, который зашит в конце шеллкода. </p><figure class="full-width"><img data-blurred="true" data-src="https://habrastorage.org/getpro/habr/upload_files/ede/07d/68b/ede07d68bbc61ce85807e9678921a64c.jpg" height="25" src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/ede/07d/68b/ede07d68bbc61ce85807e9678921a64c.jpg" width="545"/></figure><p>Первый DWORD — это длина пакета, далее следует захардкоженная строка <code>efaSnigoL</code> (перевернутая строка <code>LoginSafe</code>). </p><figure class=""><img data-blurred="true" data-src="https://habrastorage.org/getpro/habr/upload_files/a15/200/844/a15200844e58d8cb282cb10f08f4069c.jpg" height="240" src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/a15/200/844/a15200844e58d8cb282cb10f08f4069c.jpg" width="509"/></figure><p>В ответ на этот пакет приходит шеллкод второго этапа, которому передается управление. Также шеллкод № 1 передает шеллкоду № 2 адрес C2. </p><figure class="full-width"><img data-blurred="true" data-src="https://habrastorage.org/getpro/habr/upload_files/5ce/97b/484/5ce97b4840113da3a49575c3a521af28.jpg" height="803" src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/5ce/97b/484/5ce97b4840113da3a49575c3a521af28.jpg" width="744"/></figure><h3>Шеллкод № 2 </h3><p>Второй шеллкод вначале также получает адреса API-функции из ntdll по тому же хеш-алгоритму, что и первый, только в этом случае используется следующее значение poly: <code>0x8596741254585658</code>. </p><p>Назначение шеллкода — загрузка PE-модуля, который располагается после самого шеллкода.</p><figure class="full-width"><img data-blurred="true" data-src="https://habrastorage.org/getpro/habr/upload_files/206/395/3e5/2063953e55d4ed36ddc550c616a04964.jpg" height="399" src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/206/395/3e5/2063953e55d4ed36ddc550c616a04964.jpg" width="875"/></figure><p>После загрузки модуля шеллкод находит в таблице экспорта функцию Online и передает ей управление. </p><h2>Основной модуль</h2><p>Модуль является x64 DLL с единственным экспортом — <code>Online</code>. Дата и время компиляции (из заголовка) — 05.11.2023 03:00:19. Имя библиотеки в таблице экспорта — <code>online.dll</code>. </p><h3>Online</h3><p>Вначале создается событие <code>Global\safeRat</code> — именно по нему мы и дали впоследствии название вредоносу.             </p><figure class=""><img data-blurred="true" data-src="https://habrastorage.org/getpro/habr/upload_files/6d3/a13/036/6d3a13036ef5e04829d705f912465b5e.jpg" height="62" src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/6d3/a13/036/6d3a13036ef5e04829d705f912465b5e.jpg" width="392"/></figure><p>После этого модуль избавляется от перехватов библиотечных функций, которые могли быть установлены антивирусом или XDR-системой.</p><figure class=""><img data-blurred="true" data-src="https://habrastorage.org/getpro/habr/upload_files/43e/190/fdb/43e190fdba42870903c3fa2da2f479e5.jpg" height="206" src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/43e/190/fdb/43e190fdba42870903c3fa2da2f479e5.jpg" width="445"/></figure><p>Суть метода состоит в том, что бинарный файл с помощью <code>CreateFileMappingA</code> отображает в памяти файл библиотеки из системной директории, затем устанавливает на секцию TEXT загруженного в процесс модуля права RWX и перезаписывает секцию в модуле содержимым отображенного файла — чтобы содержание модуля соответствовало файлу. После этого возвращаются ранее установленные права на секцию.   </p><p>Среди других функций <code>Online</code>: </p><ul><li><p>установка обработчика исключений верхнего уровня, единственная задача которого состоит в том, чтобы перезапустить процесс в случае необрабатываемого исключения; </p></li><li><p>поиск адреса функции <code>NtTraceEvent</code> и патчинг первого байта этой функции на <code>0xC3</code> (ret), чтобы от вредоносного процесса не регистрировались ETW-события для EDR-системы и других средств защиты; </p></li><li><p>поиск и сохранение номера syscall NtQueryInformationProcess для дальнейшего использования; </p></li><li><p>создание путей для файлов wallet.safe и clip.safe в директории <code>C:\ProgramData</code> (файл <code>clip.safe</code> — для сохранения содержимого буфера обмена, а файл <code>wallet.safe</code> — для результатов работы кейлоггера); </p></li><li><p>считывание из реестра сохраненного адреса C2 (в дальнейшем семпл может запросить у текущего сервера новый адрес и сохранить его в реестре, но вначале это значение отсутствует);</p></li><li><p>хранение адреса C2 и других значений по пути <code>HKCU\Software\&lt;computer_name&gt;</code> (если имя компьютера получить не удалось, то вместо него используется строка <code>UnKnow</code>). </p></li></ul><figure class=""><img data-blurred="true" data-src="https://habrastorage.org/getpro/habr/upload_files/aa2/2e8/b69/aa22e8b69562d64d5eaa77ac9b033f9f.jpg" height="249" src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/aa2/2e8/b69/aa22e8b69562d64d5eaa77ac9b033f9f.jpg" width="392"/></figure><p>Упомянутое выше новое значение сервера хранится в параметре <code>Mov</code>, закодированное base64 и зашифрованное побайтным XOR (<code>0x46</code>). </p><figure class=""><img data-blurred="true" data-src="https://habrastorage.org/getpro/habr/upload_files/8de/cb7/c42/8decb7c425ac3b3ed5dc340078bb6e1c.jpg" height="275" src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/8de/cb7/c42/8decb7c425ac3b3ed5dc340078bb6e1c.jpg" width="388"/></figure><p>Основные функции семпла выполняются в отдельном потоке, который создается из функции <code>Online</code>. В начале этого потока создается объект класса <code>CClientSocket</code>, который отвечает за сетевое взаимодействие. </p><p>Стоит отметить, что в этом объекте есть несколько вложенных объектов класса <code>CBuffer</code>, который предоставляет динамический буфер для хранения отправляемых и принимаемых данных. Далее объект клиента подключается к серверу по TCP. Прием и обработка входящих пакетов выполняются в отдельном потоке. Следующим этапом становится создание объекта класса <code>CKernelManager</code>, который наследуется от класса <code>CManager</code> и служит своего рода оркестратором для рабочих потоков и плагинов, получаемых от C2. В конструкторе CKernelManager создается отдельный поток, отвечающий за работу кейлоггера. Причем получение данных с клавиатуры выполняется через интерфейс <code>IDirectInput8A</code> и устройство <code>SysKeyboard</code>. </p><figure class="full-width"><img data-blurred="true" data-src="https://habrastorage.org/getpro/habr/upload_files/29b/bcd/dd3/29bbcddd379f2dc5bb60b2f2c5e5396f.jpg" height="431" src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/29b/bcd/dd3/29bbcddd379f2dc5bb60b2f2c5e5396f.jpg" width="887"/></figure><p>После этого семпл собирает начальную информацию о системе для отправки на сервер. В нее входят: </p><ul><li><p>IP-адрес зараженного устройства, </p></li><li><p>имя компьютера, </p></li><li><p>имя пользователя, </p></li><li><p>PID вредоносного процесса, </p></li><li><p>список установленных антивирусов, </p></li><li><p>статус пользователя (является ли он администратором),</p></li><li><p>разность тиков процессора: <code>GetTickCount64 − GetTickCount64()</code> (вероятно, для проверки работы в ВМ), </p></li><li><p>локальное время. </p></li></ul><p>Результат можно представить в виде следующей структуры: </p><pre><code class="cpp">#pragma pack(push, 1)
struct system_info 
{
    char sz; 
    char host_ip_addr[130];
    char reg_remark_or_comp_name[50];
    char username[51];
    uint32_t curr_pid;
    char gap_EC[64];
    char AVs[128];
    char reg_cfg_Group_val;
    char gap_1AD[63];
    char is_admin;
    char module_filename[255];
    char reg_cfg_Run_val[3];
    char gap_2EF[5];
    uint32_t ticks_diff;
    SYSTEMTIME localtime;
};
#pragma pack(pop)</code></pre><p>Данные о системе отправляются на сервер. Для этого они сжимаются Zlib и шифруются RC4. Для шифрования генерируется случайный ключ с помощью <code>rand % 511</code>. Либо задается как <code>123</code>. Далее это число форматируется в виде строки и используется для RC4.        </p><figure class=""><img data-blurred="true" data-src="https://habrastorage.org/getpro/habr/upload_files/241/55f/9a4/24155f9a42dc7c99ddb77dfc5dff1141.jpg" height="601" src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/241/55f/9a4/24155f9a42dc7c99ddb77dfc5dff1141.jpg" width="436"/></figure><p>Структуру пакета клиента можно представить следующим образом:</p><pre><code class="cpp">struct packet 
{ 
  uint32_t key;
  uint32_t packet_size;
  uint32_t payload_size;
  uint8_t payload[payload_size]; 
};  </code></pre><p>Стоит отметить, что указывается длина разжатого пейлоада в переменной <code>payload_size</code>. От C2 приходит пакет аналогичной структуры, за исключением того, что поля <code>key</code> и <code>packet_size</code> поменяны местами, то есть размер пакета содержится в нулевом DWORD, а ключ — в первом. В трафике это выглядит следующим образом: </p><figure class="full-width"><img alt="" data-src="https://habrastorage.org/getpro/habr/upload_files/55c/fb2/fa0/55cfb2fa0a807446371fc98d1bd378c4.png" height="483" src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/55c/fb2/fa0/55cfb2fa0a807446371fc98d1bd378c4.png" title="" width="800"/></figure><p>Расшифрованную сессию можно посмотреть в «<a href="https://gchq.github.io/CyberChef/#recipe=From_Hex('Auto')RC4(%7B'option':'UTF8','string':'481'%7D,'Latin1','Latin1')Zlib_Inflate(0,0,'Adaptive',false,false)Find_/_Replace(%7B'option':'Regex','string':'%5B%5C%5Cx00%5D%7B1,%7D'%7D,'%5C%5Cn',true,false,true,false)To_Hexdump(16,false,false,false)&amp;input=ZDFkN2NiMTNjM2JlNzAxZTI2ZWEzMTgxYTVlNzg0N2JkZDk1MTFiNWY3ZTQ1ZWFkY2NmMTVlYjMwOWUzODViMjU3MjJkMDAxNWNhMzBlZTViMTIyMTcyZDMzMGI4N2U0NTg2ZTliZjBiN2M2YTM3NjEyMDE4N2UyMDk3MGMyOWQ2NTRiMzgxZDhhOWMxZDZhOTc5NzJkY2FmYThhYzI4MmI1OWM1MzYyMDI3MjRmNWRjOWJhNGJlMWZmYmNiNDAyMjUxZjQ0MzFkNzA0ZjRhOGMwMmQ1MjZlYmIyODllM2E2NzM1Nzk3YWVjZmQ1ZWFhMGJmMDY4NTA">Кибершефе</a>».</p><p>После расшифровки и распаковки пакета от сервера семпл проверяет нулевой байт, в котором содержится идентификатор команды (в данном случае <code>0e</code>). Обработку команд выполняет объект <code>CKernelManager</code>. В ответ клиент посылает серверу отстук в виде той же самой команды. </p><figure class="full-width"><img data-blurred="true" data-src="https://habrastorage.org/getpro/habr/upload_files/589/f8f/07e/589f8f07edd6d8b92239e8023cea97ae.jpg" height="733" src="https://habrastorage.org/r/w780q1/getpro/habr/upload_files/589/f8f/07e/589f8f07edd6d8b92239e8023cea97ae.jpg" width="998"/></figure><div><div class="table"><table><tbody><tr><td data-colwidth="350" width="350"><p align="center"><strong>Идентификатор команды</strong></p></td><td><p align="center"><strong>Описание</strong></p></td></tr><tr><td data-colwidth="350" width="350"><p align="center">   0    </p></td><td><p align="left">Разлогинивает текущего пользователя Windows    </p></td></tr><tr><td data-colwidth="350" width="350"><p align="center">2</p></td><td><p align="left">Устанавливает флаг завершения работы    </p></td></tr><tr><td data-colwidth="350" width="350"><p align="center">3</p></td><td><p align="left">Сохраняет в реестре новое значение параметра <code>Remark</code> </p></td></tr><tr><td data-colwidth="350" width="350"><p align="center">4</p></td><td><p align="left">Сохраняет в реестре новое значение параметра <code>Group</code> </p></td></tr><tr><td data-colwidth="350" width="350"><p align="center">6­–12, 14­–­­17, 19­–21, 25, 32­­–34    </p></td><td><p align="left">Запускает плагин (номер команды — идентификатор плагина)    </p></td></tr><tr><td data-colwidth="350" width="350"><p align="center">13</p></td><td><p align="left">Вызывает BSOD с помощью <code>NtRaiseHardError</code>, предварительно получив привилегию SeShutdownPrivilege    </p></td></tr><tr><td data-colwidth="350" width="350"><p align="center">18</p></td><td><p align="left">Запускает поток клиппера (стилер буфера обмена)    </p></td></tr><tr><td data-colwidth="350" width="350"><p align="center">22</p></td><td><p align="left">Обновляет C2    </p></td></tr><tr><td data-colwidth="350" width="350"><p align="center">23</p></td><td><p align="left">Запускает кейлоггер    </p></td></tr><tr><td data-colwidth="350" width="350"><p align="center">24</p></td><td><p align="left">Запускает поток клиппера (стилер буфера обмена)    </p></td></tr><tr><td data-colwidth="350" width="350"><p align="center">26­–31    </p></td><td><p align="left">Получает и запускает новый модуль</p></td></tr><tr><td data-colwidth="350" width="350"><p align="center">35</p></td><td><p align="left">Сохраняет в реестре новое значение параметра <code>Run</code> </p></td></tr><tr><td data-colwidth="350" width="350"><p align="center">36­–42    </p></td><td><p>В зависимости от номера команды стилер похищает данные: <br/>· QQBrowser,<br/>· Telegram,<br/>· Chrome,<br/>· Firefox,<br/>· 360 Secure Browser,<br/>· Sogou Explorer</p></td></tr></tbody></table></div></div><h2>Заключение</h2><p>Исходя из оригинального имени в сервисе <a href="https://www.virustotal.com/gui/file/0bc5545cf48254aff60e1757e45f7020a64ee9eda2e6db9352e9107811309f8e">VirusTotal</a> и некоторых целей SafeRAT (Sogou, 360 Secure Browser, QQBrowser), предполагаем, что вредонос рассчитан на китайскоговорящих пользователей. </p><p>Судя по именам классов (<code>CKernelManager</code>, <code>CClientSocket</code>) и общей архитектуре кода, можно сделать вывод, что SafeRAT — это очередная поделка, основанная на утекших исходниках Gh0st, только с урезанной функциональностью. </p><a class="anchor" id="1" name="1"></a><details class="spoiler"><summary>Вердикты наших продуктов</summary><div class="spoiler__content"><p>PT Sandbox: </p><ul><li><p>tool_win_ZZ_SafeRAT__Backdoor__Loader </p></li><li><p>tool_win_ZZ_SafeRAT__Backdoor__MainModule </p></li><li><p>tool_mem_ZZ_SafeRAT__Backdoor__MainModule </p></li><li><p>tool_win_ZZ_SafeRAT__Backdoor__Shellcode </p></li><li><p>tool_mem_ZZ_SafeRAT__Backdoor__Shellcode </p></li><li><p>Trojan-Downloader.Win32.SafeRAT.a </p></li></ul><p>PT Network Attack Discovery: </p><ul><li><p>REMOTE [PTsecurity] SafeRAT 10010258 </p></li><li><p>REMOTE [PTsecurity] SafeRAT 10010259 </p></li><li><p>REMOTE [PTsecurity] SafeRAT 10010260 </p></li></ul><p></p></div></details><details class="spoiler"><summary>Индикаторы компрометации</summary><div class="spoiler__content"><p>Загрузчики:</p><ul><li><p>0bc5545cf48254aff60e1757e45f7020a64ee9eda2e6db9352e9107811309f8e</p></li><li><p>1720528e27ba5ceaa207de277155ddf1880f1d3d3dacd5ee61f54c908712d63c</p></li><li><p>1c84b5fe2ae149b94c3da5bb0a925a03121b40c425bad018e39e1bf22667d597</p></li><li><p>63943b876cad63a0024e908f8c412a63aec181b6765cfa0365bbdee90943694f</p></li><li><p>6d09ee4e5800516fb1f4afb65de6fccb0861757a2b366157c401826e7fbe6b55</p></li><li><p>6dbce4cd9e1c3c024c43424699ee3510ad7453a48d8c966f995995de23b7333f</p></li><li><p>acee04a9da6a6fc6e78bddd8285d9d7a0e8bbd9da73171b87a3e04917fbbab5d</p></li><li><p>aef9cfcabb5f39bcb66ee081d42e30461abcc55601f5f3236abbc5435911a2e4</p></li><li><p>b1c19d93439f8f773910e386bb108f95050b6188e48a2607fb38e9083b974262</p></li><li><p>b60280482ec39af421c349c480163e466d300334f748ea9d479203258198baf6</p></li></ul><p>Шеллкоды: </p><ul><li><p>215a4fefc44e9cf8e3b2e320e09cca29f1cda0eac8b99844d72ef36c14939803 </p></li><li><p>5d8981b146880cbee147a07f9905de2c1fb75e965386b7c3d12a4a2ccee0da85 </p></li></ul><p>Основной модуль: </p><ul><li><p>979f17cad701227065fd405eeaeb1e00a917ae605c1616d4de92ba6da86407bc</p></li></ul><p>Сетевые индикаторы: </p><ul><li><p>103.216.152.150:280</p></li><li><p>103.216.152.150:3300</p></li><li><p>104.218.234.78:280</p></li><li><p>104.218.234.78:8000</p></li><li><p>154.213.17.136:8000</p></li><li><p>154.213.17.147:280</p></li><li><p>154.23.182.133:280</p></li><li><p>154.23.182.133:8000</p></li><li><p>154.23.182.24:280</p></li><li><p>154.23.187.249:280</p></li><li><p>154.23.187.249:8000</p></li><li><p>154.55.128.137:280</p></li><li><p>154.55.128.137:8000</p></li><li><p>156.245.19.172:280</p></li><li><p>202.95.14.203:8000</p></li><li><p>202.95.14.223:280</p></li><li><p>27.124.4.221:8000</p></li><li><p>27.124.4.228:280</p></li><li><p>27.124.4.229:280</p></li><li><p>27.124.44.10:280</p></li><li><p>27.124.44.3:8000</p></li><li><p>43.135.39.104:280</p></li><li><p>43.135.39.104:8000</p></li><li><p>43.243.73.220:280</p></li><li><p>43.243.73.220:8000</p></li><li><p>45.195.204.101:280</p></li><li><p>45.195.204.36:280</p></li><li><p>45.195.204.76:8000</p></li><li><p>45.248.11.63:280</p></li><li><p>45.248.11.63:8000</p></li><li><p>45.249.93.80:280</p></li><li><p>45.249.93.80:8000</p></li></ul><p></p></div></details><p></p></div></div></div> <!-- --> <!-- --></div> <!-- --> <!-- --></div> <!-- --> <div class="tm-article-presenter__meta"><div class="tm-article-presenter__meta-list tm-separated-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a class="tm-tags-list__link" href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Brat%5D">rat</a></li><li class="tm-separated-list__item"><a class="tm-tags-list__link" href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bcybersecurity%5D">cybersecurity</a></li><li class="tm-separated-list__item"><a class="tm-tags-list__link" href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bsandbox%5D">sandbox</a></li><li class="tm-separated-list__item"><a class="tm-tags-list__link" href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%81%D1%82%D0%B8%D0%BB%D0%B5%D1%80%5D">стилер</a></li><li class="tm-separated-list__item"><a class="tm-tags-list__link" href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%BA%D1%80%D0%B0%D0%B6%D0%B0%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%5D">кража данных</a></li><li class="tm-separated-list__item"><a class="tm-tags-list__link" href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bmalware%5D">malware</a></li><li class="tm-separated-list__item"><a class="tm-tags-list__link" href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%88%D0%B8%D1%84%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%5D">шифрование данных</a></li><li class="tm-separated-list__item"><a class="tm-tags-list__link" href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D1%81%D0%B5%D1%82%D0%B5%D0%B2%D0%BE%D0%B9%20%D1%82%D1%80%D0%B0%D1%84%D0%B8%D0%BA%5D">сетевой трафик</a></li><li class="tm-separated-list__item"><a class="tm-tags-list__link" href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%B2%D0%BF%D0%BE%5D">впо</a></li><li class="tm-separated-list__item"><a class="tm-tags-list__link" href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5B%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D1%87%D0%B8%D0%BA%5D">загрузчик</a></li> <!-- --></ul></div> <div class="tm-article-presenter__meta-list tm-separated-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a class="tm-hubs-list__link router-link-active" href="/ru/companies/pt/articles/">Блог компании Positive Technologies</a></li><li class="tm-separated-list__item"><a class="tm-hubs-list__link" href="/ru/hubs/infosecurity/">Информационная безопасность</a></li><li class="tm-separated-list__item"><a class="tm-hubs-list__link" href="/ru/hubs/virus/">Антивирусная защита</a></li><li class="tm-separated-list__item"><a class="tm-hubs-list__link" href="/ru/hubs/network_technologies/">Сетевые технологии</a></li><li class="tm-separated-list__item"><a class="tm-hubs-list__link" href="/ru/hubs/reverse-engineering/">Реверс-инжиниринг</a></li> <!-- --></ul></div></div> <!-- --></article></div> <!-- --></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-lever tm-article-rating__votes-switcher tm-votes-lever tm-votes-lever_appearance-article" title="Всего голосов 11: ↑11 и ↓0"><button class="tm-votes-lever__button" title="Нравится" type="button"><svg class="tm-svg-img tm-votes-lever__icon" height="24" width="24"><title>Голосование</title> <use xlink:href="/img/megazord-v28.faec9762..svg#counter-vote"></use></svg></button> <div class="tm-votes-lever__score tm-votes-lever__score tm-votes-lever__score_appearance-article"><span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter tm-votes-lever__score-counter_positive">
          +11
        </span></span></div> <button class="tm-votes-lever__button" title="Не нравится" type="button"><svg class="tm-svg-img tm-votes-lever__icon tm-votes-lever__icon_arrow-down" height="24" width="24"><title>Голосование</title> <use xlink:href="/img/megazord-v28.faec9762..svg#counter-vote"></use></svg></button></div> <div class="v-portal" style="display:none;"></div> <!-- --></div> <!-- --> <!-- --> <button class="bookmarks-button tm-data-icons__item" title="Добавить в закладки" type="button"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg class="tm-svg-img tm-svg-icon" height="24" width="24"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v28.faec9762..svg#counter-favorite"></use></svg></span> <span class="bookmarks-button__counter" title="Количество пользователей, добавивших публикацию в закладки">
    5
  </span></button> <div class="tm-sharing tm-data-icons__item" title="Поделиться"><button class="tm-sharing__button" type="button"><svg class="tm-sharing__icon" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13.8 13.8V18l7.2-6.6L13.8 5v3.9C5 8.9 3 18.6 3 18.6c2.5-4.4 6-4.8 10.8-4.8z" fill="currentColor"></path></svg></button> <div class="v-portal" style="display:none;"></div></div> <div class="tm-article-comments-counter-link tm-data-icons__item" title="Читать комментарии"><a class="tm-article-comments-counter-link__link" href="/ru/companies/pt/articles/793440/comments/"><svg class="tm-svg-img tm-article-comments-counter-link__icon" height="24" width="24"><title>Комментарии</title> <use xlink:href="/img/megazord-v28.faec9762..svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      2
    </span></a> <!-- --></div> <!-- --> <div class="v-portal" style="display:none;"></div></div></div></div> <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!-- --> <section class="tm-block tm-block tm-block_spacing-bottom"><!-- --> <div class="tm-block__body tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"><div class="tm-article-author__company"><div class="tm-article-author__company-card"><div class="tm-company-snippet"><a class="tm-company-snippet__logo-link" href="/ru/companies/pt/profile/"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" height="40" src="//habrastorage.org/getpro/habr/company/00b/f9c/27a/00bf9c27a7e0ab9d98f5f973a18d62fd.png" width="40"/></div></a> <div class="tm-company-snippet__info"><a class="tm-company-snippet__title" href="/ru/companies/pt/profile/">Positive Technologies</a> <div class="tm-company-snippet__description">Лидер результативной кибербезопасности</div></div></div> <div class="tm-article-author__buttons"><!-- --> <!-- --></div></div> <!-- --> <div class="tm-article-author__separator"></div></div> <div class="tm-user-card tm-article-author__user-card tm-user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a class="tm-user-card__userpic tm-user-card__userpic_size-40" href="/ru/users/naumovax/"><div class="tm-entity-image"><img alt="" class="tm-entity-image__pic" src="//habrastorage.org/getpro/habr/avatars/772/0cc/637/7720cc6370da32f886345dcf87caf92f.jpg"/></div></a> <div class="tm-user-card__meta"><div class="tm-counter-container tm-karma tm-karma" title=" 4 голоса "><div class="tm-counter-container__header"><div class="tm-karma__votes tm-karma__votes_positive">
      4
    </div></div> <div class="tm-counter-container__footer"><div class="tm-karma__text">
      Карма
    </div> <div class="v-portal" style="display:none;"></div></div></div> <div class="tm-counter-container" title="Рейтинг пользователя"><div class="tm-counter-container__header"> <div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating"><!-- --> <div class="tm-votes-lever__score tm-votes-lever__score tm-votes-lever__score_appearance-rating"><span><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter tm-votes-lever__score-counter_rating">
          11
        </span></span></div> <!-- --></div></div> <div class="tm-counter-container__footer"><span class="tm-rating__text tm-rating__text">
      Рейтинг
    </span></div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title tm-user-card__title_variant-article"><!-- --> <a class="tm-user-card__nickname tm-user-card__nickname tm-user-card__nickname_variant-article" href="/ru/users/naumovax/">
          @naumovax
        </a> <!-- --></div> <p class="tm-user-card__short-info tm-user-card__short-info tm-user-card__short-info_variant-article">Сетевой аналитик вредоносного ПО</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons tm-user-card__buttons_variant-article"><!-- --> <!-- --> <!-- --> <!-- --></div></div> <!-- --></div></div> <!-- --></section> <!-- --> <!-- --> <div class="tm-article-blocks__comments"><div class="tm-article-page-comments" id="publication-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style" href="/ru/companies/pt/articles/793440/comments/"><svg class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted" height="24" width="24"><title>Комментарии</title> <use xlink:href="/img/megazord-v28.faec9762..svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 2 
    </span></a> <!-- --></div></div></div> <section class="tm-block tm-block tm-block_spacing-bottom"><header class="tm-block__header tm-block__header tm-block__header_variant-borderless"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title tm-block__title_variant-large">Публикации</h2> </div> <!-- --></header> <div class="tm-block__body tm-block__body tm-block__body_variant-condensed-slim"><div class="tm-tabs tm-tabs"><div><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link tm-tabs__tab-link_active tm-tabs__tab-link_slim">
        Лучшие за сутки
      </button></span><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link tm-tabs__tab-link_slim">
        Похожие
      </button></span></div> <!-- --></div> <div class="similar-and-daily__tab-view"><div class="placeholder-wrapper"><!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <div class="tm-placeholder-article-cards"><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div></div> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --></div> <!-- --></div></div> <!-- --></section> <div class="placeholder-wrapper"><!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <div class="tm-placeholder-inset tm-placeholder-vacancies"><div class="tm-placeholder-inset__header"><div class="tm-placeholder__line tm-placeholder__line_inset-header loads"></div></div> <div class="tm-placeholder-inset__body"><ul class="tm-placeholder-list"><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li></ul></div> <div class="tm-placeholder-inset__footer"><div class="tm-placeholder__line tm-placeholder__line_inset-footer loads"></div></div></div> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --> <!-- --></div> <!-- --> </div></div></div></div></div> <div class="tm-page__sidebar"><!-- --></div></div></div></div></main> <!-- --></div> <!-- --> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><div class="tm-footer__title"><a class="tm-svg-icon__wrapper tm-footer__title-link" href="/ru/"><svg class="tm-svg-img tm-svg-icon" height="16" width="16"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a></div> <div class="tm-footer__social"><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>Facebook</title> <use xlink:href="/img/new-social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>Twitter</title> <use xlink:href="/img/new-social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>VK</title> <use xlink:href="/img/new-social-icons-sprite.svg#social-logo-vk"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>Telegram</title> <use xlink:href="/img/new-social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>Youtube</title> <use xlink:href="/img/new-social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a class="tm-svg-icon__wrapper tm-social-icons__icon" href="https://dzen.ru/habr" rel="nofollow noopener noreferrer" target="_blank"><svg class="tm-svg-img tm-svg-icon" height="36" width="36"><title>Яндекс Дзен</title> <use xlink:href="/img/new-social-icons-sprite.svg#social-logo-dzen"></use></svg></a></div> <div class="v-portal" style="display:none;"></div> <button class="tm-footer__link"><svg class="tm-svg-img tm-footer__icon" height="16" width="16"><title>Язык</title> <use xlink:href="/img/megazord-v28.faec9762..svg#lang"></use></svg>
        Настройка языка
      </button> <a class="tm-footer__link" href="/ru/feedback/">
        Техническая поддержка
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2024, </span> <span class="tm-copyright__name"><a class="tm-copyright__link" href="https://company.habr.com/" rel="noopener" target="_blank">Habr</a></span></span></div></div></div></div> <!-- --></div> <div class="vue-portal-target"></div></div>





<noscript>
<div>
<img alt="" src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;">
</img></div>
</noscript>


</body>
</html>
